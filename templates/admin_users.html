{% extends 'base.html' %}
{% block title %}Manage Users â€¢ Orish{% endblock %}
{% block content %}
<section class="card admin admin-users">
    <div class="card-head">
        <div>
            <p class="eyebrow">Teacher controls</p>
            <h1>User roles</h1>
            <p class="muted">Promote active learners, invite new ones, and keep teacher tools in one place.</p>
        </div>
        <div class="admin-actions">
            <a class="btn secondary" href="{{ url_for('admin_questions') }}">Question bank</a>
            <a class="btn secondary" href="{{ url_for('exams') }}">Exam studio</a>
        </div>
    </div>
    <div class="admin-body user-stack">
        <section class="admin-form wide">
            <h3>Create a new account</h3>
            <form method="post">
                <input type="hidden" name="action" value="create">
                <div class="grid two">
                    <label>Username<input name="username" required></label>
                    <label>Email<input type="email" name="email" required></label>
                </div>
                <div class="grid two">
                    <label>Password<input type="password" name="password" minlength="8" required></label>
                    <label>Role
                        <select name="role">
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                        </select>
                    </label>
                </div>
                <button class="btn primary">Create account</button>
            </form>
        </section>
        <section class="admin-list">
            <h3>Teachers</h3>
            <div class="table-scroll">
                <table class="attempt-table user-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in teachers %}
                        <tr data-user-row="{{ user.id }}">
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                <div class="user-actions">
                                    <form method="post">
                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                        <input type="hidden" name="action" value="demote">
                                        <button class="btn ghost" type="submit" {% if user.id == g.user['id'] %}disabled{% endif %}>Set as student</button>
                                    </form>
                                    {% if user.id != g.user['id'] %}
                                    <form method="post" class="js-delete-user" data-user-name="{{ user.username }}">
                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                        <input type="hidden" name="action" value="delete">
                                        <button class="btn danger ghost" type="submit">Delete</button>
                                    </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3">No teacher accounts yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        <section class="admin-list">
            <h3>Students</h3>
            <div class="table-scroll">
                <table class="attempt-table user-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in students %}
                        <tr data-user-row="{{ user.id }}">
                            <td>{{ user.username }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                <div class="user-actions">
                                    <form method="post">
                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                        <input type="hidden" name="action" value="promote">
                                        <button class="btn primary" type="submit">Make teacher</button>
                                    </form>
                                    <form method="post" class="js-delete-user" data-user-name="{{ user.username }}">
                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                        <input type="hidden" name="action" value="delete">
                                        <button class="btn danger ghost" type="submit">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3">No students yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</section>
{% endblock %}
