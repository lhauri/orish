{% extends 'base.html' %}
{% block title %}Admin â€¢ Orish{% endblock %}
{% block content %}
<div class="card admin">
    <div class="admin-header">
        <h2>Question bank</h2>
        <form method="get">
            <label>
                Category
                <select name="category" onchange="this.form.submit()">
                    {% for key, meta in categories.items() %}
                    <option value="{{ key }}" {% if key == category %}selected{% endif %}>{{ meta.label }}</option>
                    {% endfor %}
                </select>
            </label>
        </form>
    </div>

    <div class="admin-body">
        <section class="admin-form">
            <h3>AI generate {{ categories[category].label }} questions</h3>
            <form method="post" action="{{ url_for('generate_question_ai', category=category) }}">
                <label>Prompt<textarea name="prompt" rows="3" placeholder="e.g. Focus on travel vocabulary, B1 level."></textarea></label>
                <button class="btn secondary">Generate via AI</button>
            </form>
        </section>
        <section class="admin-form">
            <h3>Add new {{ categories[category].label }} question</h3>
            <form method="post" action="{{ url_for('add_question', category=category) }}">
                {% if category == 'vocabulary' %}
                <label>Word<input name="word" required></label>
                {% elif category == 'grammar' %}
                <label>Sentence (use __ for blank)<textarea name="sentence" required></textarea></label>
                {% elif category == 'reading' %}
                <label>Title<input name="title" required></label>
                <label>Reading text<textarea name="text" rows="4" required></textarea></label>
                <label>Question<input name="question" required></label>
                {% else %}
                <label>Prompt<textarea name="prompt" rows="4" required></textarea></label>
                <label>Reference answer<textarea name="reference_answer" rows="3" required></textarea></label>
                {% endif %}
                {% if category != 'translation' %}
                <label>Correct answer<input name="correct_answer" required></label>
                <label>Wrong option 1<input name="wrong1" required></label>
                <label>Wrong option 2<input name="wrong2" required></label>
                <label>Wrong option 3<input name="wrong3" required></label>
                {% endif %}
                <button class="btn primary">Save question</button>
            </form>
        </section>
        <section class="admin-list">
            <h3>Existing questions ({{ rows|length }})</h3>
            <ul>
                {% for row in rows %}
                <li>
                    <div>
                        {% if category == 'vocabulary' %}
                        <strong>{{ row['word'] }}</strong>
                        {% elif category == 'grammar' %}
                        <strong>{{ row['sentence_with_placeholder'] }}</strong>
                        {% elif category == 'reading' %}
                        <strong>{{ row['title'] }}</strong>
                        <p class="muted">{{ row['question'] }}</p>
                        {% else %}
                        <strong>{{ row['prompt']|truncate(60, True) }}</strong>
                        <p class="muted">Ref: {{ row['reference_answer']|truncate(60, True) }}</p>
                        {% endif %}
                    </div>
                    <div class="admin-actions">
                        <a class="btn ghost" href="{{ url_for('edit_question', category=category, question_id=row['id']) }}">Edit</a>
                        <form method="post" action="{{ url_for('delete_question', category=category, question_id=row['id']) }}" onsubmit="return confirm('Delete question?')">
                            <button class="btn danger">Delete</button>
                        </form>
                    </div>
                </li>
                {% else %}
                <li>No questions yet.</li>
                {% endfor %}
            </ul>
        </section>
    </div>
</div>
{% endblock %}
